<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DM CONTROL - Salidas de Personal</title>
    <meta http-equiv="refresh" content="15"> 

    <link rel="stylesheet" href="{{ url_for('static', filename='css/pantalla_personal.css') }}">
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='IMG/dm_logo corto.png') }}">

    <style>
        /* 1. Prepara los contenedores para el scroll */
        .current-departure-routes-wrapper, 
        .carousel-container {
            overflow-x: auto;   /* Muestra el scroll H-horizontal SÓLO si es necesario */
            overflow-y: hidden; /* Oculta el scroll vertical */
            
            /* Opcional: Mejora el scroll en pantallas táctiles (móviles/tablets) */
            -webkit-overflow-scrolling: touch; 
        }

        /* 2. Resetea los "tracks" que se movían */
        #currentDepartureTrack, 
        #carouselTrack {
            /* Detiene cualquier animación CSS o transformación JS que haya quedado */
            transform: none !important; 
            animation: none !important;
            
            /* Asegura que los items se queden en una sola línea horizontal */
            display: flex;
            flex-wrap: nowrap; /* MUY IMPORTANTE: impide que los items salten de línea */
            
            /* Deja que el track crezca con su contenido */
            width: auto; 
            position: static; /* Resetea cualquier posicionamiento extraño */
        }

        /* 3. Impide que los items se "aplasten" o encojan */
        #currentDepartureTrack .current-route-group, 
        #carouselTrack .route-group {
            flex-shrink: 0; 
        }
    </style>
    </head>
<body>
    <header>
        <img src="{{ url_for('static', filename='IMG/dm_logo.png') }}" alt="DM CONTROL" class="header-logo">
    </header>

    <div class="current-info">
        <span>{{ fecha_actual }}</span>
        <span>{{ hora_actual }}</span>
    </div>

    <div class="main-display">
        <div class="current-departure-container">
                {% if hora_activa_para_display_12h and fecha_activa_para_display %}
                    <h2>Salidas Activas ({{ hora_activa_para_display_12h }} - {{ fecha_activa_para_display }})</h2>
                {% else %}
                    <h2>Salidas Programadas Ahora</h2>
                {% endif %}

                {% if salidas_ahora_agrupadas_por_ruta %}
                    <div class="current-departure-routes-wrapper">
                        <div class="current-routes-track" id="currentDepartureTrack">
                            {% for ruta_grupo_ahora in salidas_ahora_agrupadas_por_ruta %}
                                <div class="current-route-group">
                                    <h4>{{ ruta_grupo_ahora.nombre_ruta }}</h4>
                                    <ul class="current-time-list">
                                        {% for fecha_hora_grupo_ahora in ruta_grupo_ahora.grupos_por_fecha_hora %}
                                            <li>
                                                <strong>{{ fecha_hora_grupo_ahora.fecha }} - {{ fecha_hora_grupo_ahora.hora }}</strong>
                                                {% for salida in fecha_hora_grupo_ahora.salidas %}
                                                    <div class="current-departure-item-card">
                                                        <span>{{ salida.recorrido }}</span>
                                                        <span>{{ salida.numero_camion_manual if salida.numero_camion_manual else 'Pendiente' }}</span>
                                                    </div>
                                                {% endfor %}
                                            </li>
                                        {% endfor %}
                                    </ul>
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                {% else %}
                    <p class="no-salida">No hay salidas activas en este momento</p>
                {% endif %}
        </div>

        <div class="next-departures">
            <h3>Próximas Salidas</h3>
            {% if proximas_salidas_agrupadas_por_ruta %}
                <div class="carousel-container">
                    <div class="carousel-track" id="carouselTrack">
                        {% for ruta_grupo in proximas_salidas_agrupadas_por_ruta %}
                            <div class="route-group">
                                <h4>{{ ruta_grupo.nombre_ruta }}</h4>
                                <ul class="time-list">
                                    {% for fecha_hora_grupo in ruta_grupo.grupos_por_fecha_hora %}
                                        <li>
                                            <strong>{{ fecha_hora_grupo.fecha }} - {{ fecha_hora_grupo.hora }}</strong>
                                            {% for salida in fecha_hora_grupo.salidas %}
                                                <div class="route-item-card">
                                                    <span>{{ salida.recorrido }}</span>
                                                    <span>{{ salida.numero_camion_manual if salida.numero_camion_manual else 'Pendiente' }}</span>
                                                </div>
                                            {% endfor %}
                                        </li>
                                    {% endfor %}
                                </ul>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            {% else %}
                <div class="carousel-container" style="display: flex; justify-content: center; align-items: center;">
                    <p style="color: #ffffff; font-size: 1.8em; font-weight: 600;">No hay próximas salidas programadas</p>
                </div>
            {% endif %}
        </div>
    </div>

    <footer>
        Actualizado automáticamente cada 15 segundos
    </footer>

    <script>
        /* * El JavaScript del carrusel automático ha sido eliminado 
         * para dejar el contenido fijo y con scroll horizontal (manejado por CSS).
         */
    </script>
</body>
</html>